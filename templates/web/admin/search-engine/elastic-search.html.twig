<h1>{{ 'ElasticSearch configuration' | trans }}</h1>

{{ form(form) }}

<form id="ElasticSearchDropIndexForm" action="{{ path('admin_searchengine_drop_index') }}" method="POST">
</form>
<form id="ElasticSearchCreateIndexForm" action="{{ path('admin_searchengine_create_index') }}" method="POST">
</form>

<div id="dropIndexConfirmDialog">Really drop index ?</div>

{% block javascript %}
<script type="text/javascript" src="{{ path('minifier', { 'f' : '/scripts/apps/admin/search-engine/views/es_config.js' }) }}"></script>
<script type="text/javascript">
    {% if indexer.indexExists() %}
    var elasticSearchIndexExists = true;
    {% else %}
    var elasticSearchIndexExists = false;
    {% endif %}
    searchEngineConfigurationFormInit(elasticSearchIndexExists);

    function ajaxDumpResultIndexElasticsearch() {
        $.ajax({
            url: "{{ path('admin_searchengine_dump_result_index_elasticsearch') }}"
            , type: "POST"
            , success: function (data) {
                if (data.success) {
                    var response = data.response;
                    $('input[name="elasticsearch_settings[shards]"]').val(response['number_of_shards']);
                    $('input[name="elasticsearch_settings[replicas]"]').val(response['number_of_replicas']);
                } else {
                    if (window.console) {
                        console.log(data.message);
                    }
                    alert("{{ 'An error occured' | trans | e('js') }}" + data.message);
                }
            }
            , error: function (jqXHR, textStatus, errorThrown) {
                alert("Erreur XML:\n\n" + jqXHR.responseText);
            }
        });

        return false;
    }
</script>
{% endblock %}
