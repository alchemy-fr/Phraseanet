{# empty Twig template #}

<ul id="tree" class="filetree">

  {% if app['acl'].get(app['authentication'].getUser()).is_admin() %}
  <li>
    <a target="right" href="{{ path('admin_dashbord') }}" class="ajax">
      <img src="/skins/admin/Dashboard.png" />
      <span>{{ 'Tableau de bord' | trans }}</span>
    </a>
  </li>
  {% else %}
  <li>
    <span>{{ app['conf'].get('servername') }}</span>
  </li>
  {% endif %}

  {% if app['acl'].get(app['authentication'].getUser()).is_admin() %}
  <li>
    <a target="right" href="{{ path('setup_display_globals') }}" class="ajax">
      <img src="/skins/admin/Setup.png" />
      <span>{% trans %}Setup{% endtrans %}</span>
    </a>
  </li>
  <li>
    <a target="right" href="{{ path('admin_searchengine_get') }}">
      <span>{{ 'SearchEngine settings' | trans }}</span>
    </a>
  </li>
  {% endif %}

  <li class="{% if feature == 'connected' %}selected{% endif %}">
    <a target="right" href="{{ path('admin_connected_users') }}" class="ajax zone_online_users">
      <img src="/skins/admin/Connected.png" />
      <span>{{ 'admin::utilisateurs: utilisateurs connectes' | trans }}</span>
    </a>
  </li>

  {% if app['acl'].get(app['authentication'].getUser()).has_right('manageusers') %}
  <li class="{% if feature == 'users' %}selected{% endif %}">
    <a target="right" href="{{ path('admin_users_search') }}" class="ajax zone_editusers">
      <img src="/skins/admin/Users.png" />
      <span>{{ 'admin::utilisateurs: utilisateurs' | trans }}</span>
    </a>
  </li>
  <li class="{% if feature == 'registrations' %}selected{% endif %}">
    <a target="right" href="{{ path('users_display_registrations') }}" class="ajax">
      <img src="/skins/admin/Demandes.png" />
      <span>{{ 'admin::utilisateurs: demandes en cours' | trans }}</span>
    </a>
  </li>
  {% endif %}

  {% if app['acl'].get(app['authentication'].getUser()).has_right('bas_chupub') %}
  <li class="">
    <a target="right" href="{{ path('admin_feeds_list') }}" class="ajax">
      <img src="/skins/icons/rss16.png" />
      <span>{{ 'Publications' | trans }}</span>
    </a>
  </li>
  {% endif %}

  {% if app['acl'].get(app['authentication'].getUser()).has_right('taskmanager') %}
  <li class="{% if feature == 'taskmanager' %}selected{% endif %}">
    <a target="right" href="{{ path('admin_tasks_list') }}" class="ajax" data-ws-topic="http://phraseanet.com/topics/admin/task-manager">
      <img src="/skins/admin/TaskManager.png" />
      <span>{{ 'admin::utilisateurs: gestionnaire de taches' | trans }}</span>
    </a>
  </li>
  {% endif %}

  <li class="open">
    <div class="{% if feature == 'bases' %}selected{% endif %}" style="padding:0 0 2px 0;">
      <a id="TREE_DATABASES" target="right" href="{{ path('admin_databases') }}" class="ajax">
        <img src="/skins/admin/DatabasesAvailable.png" />
        <span>{{ 'admin::utilisateurs: bases de donnees' | trans }}</span>
      </a>
    </div>
    <ul>

    {% for databox in databoxes %}

      {% set sbas_id = databox.get_sbas_id() %}

      {% if feature in ['base', 'collection', 'user'] and featured == sbas_id %}
        {% set this_is_open = true %}
      {% else %}
        {% set this_is_open = false %}
      {% endif %}

      {% if this_is_open and feature == 'base' %}
        {% set this_is_selected = true %}
      {% else %}
        {% set this_is_selected = false %}
      {% endif %}

      <li class="{% if this_is_open %}open{% endif %}">
        <div style="padding:0 0 2px 0;" class="{% if this_is_selected %}selected{% endif %}">
            <a target="right" href="{{ path('admin_database', { 'databox_id' : sbas_id }) }}" class="ajax">
                <img src="/skins/admin/Database.png"/>
                <span>{{ databox.get_label(app['locale']) }}</span>
            </a>
        </div>
        <ul>

        {% if app['acl'].get(app['authentication'].getUser()).has_right_on_sbas( sbas_id , 'bas_modify_struct') %}
          <li>
            <a target="right" class="ajax" href="{{ path('database_display_stucture', { 'databox_id' : sbas_id }) }}">
              <img src="/skins/icons/miniadjust01.gif"/>
              <span>{{ 'admin::structure: reglage de la structure' | trans }}</span>
            </a>
          </li>
          <li>
            <a target="right" href="{{ path('admin_fields', {'sbas_id': sbas_id}) }}" class="ajax">
              <img src="/skins/icons/miniadjust01.gif"/>
              <span>{{ 'CHAMPS' | trans }}</span>
            </a>
          </li>
          <li>
            <a target="right" href="{{ path('admin_subdefs_subdef', { 'sbas_id' : sbas_id } ) }}">
              <img src="/skins/icons/miniadjust01.gif"/>
              <span>{{ 'SUBDEFS' | trans }}</span>
            </a>
          </li>
          <li>
            <a target="right" href="{{ path('database_display_statusbit', { 'databox_id' : sbas_id } ) }}" class="ajax">
              <img src="/skins/icons/miniadjust02.gif"/>
              <span>{{ 'admin::status: reglage des status' | trans }}</span>
            </a>
          </li>
          <li>
            <a target="right" href="{{ path('admin_database_display_cgus', { 'databox_id' : sbas_id } ) }}" class="ajax">
              <span>{{ 'admin:: CGUs' | trans }}</span>
            </a>
          </li>
          <li>
              <a target="right" href="{{ path('admin_database_display_collections_order', { 'databox_id' : sbas_id } ) }}" class="ajax">
              <img src="/skins/icons/miniadjust03.gif"/>
              <span>{{ 'admin::collection: ordre des collections' | trans }}</span>
            </a>
          </li>
        {% endif %}

        {% set seeUsrGene = false %}

        {% for coll in databox.get_collections() %}
          {% if app['acl'].get(app['authentication'].getUser()).has_right_on_base( coll.get_base_id() , 'canadmin') %}
            {% set seeUsrGene = true %}
          {% endif %}
        {% endfor %}

        {% if seeUsrGene %}
          <li>
            <a target="right" href="{{ path('admin_users_search', { 'sbas_id' : [ sbas_id ] }) }}" class="ajax">
              <img src="/skins/admin/Users.png"/>
              <span>{{ 'admin::utilisateurs: utilisateurs' | trans }}</span>
            </a>
          </li>
        {% endif %}

        {% for collection in databox.get_collections() %}
          {% if (collection.get_base_id() in app['acl'].get(app['authentication'].getUser()).get_granted_base(['canadmin'])|keys
              or collection.get_base_id() in app['acl'].get(app['authentication'].getUser()).get_granted_base(['manage'])|keys
              or collection.get_base_id() in app['acl'].get(app['authentication'].getUser()).get_granted_base(['modify_struct'])|keys) %}

          {% if feature == 'collection' and featured == collection.get_base_id() %}
              {% set coll_selected = true %}
          {% else %}
              {% set coll_selected = false %}
          {% endif %}

          <li>
            <div style="padding:0 0 2px 0;" {% if coll_selected %}class="selected"{% endif %}>
                <a target="right" href="{{ path('admin_display_collection', { 'bas_id' : collection.get_base_id() }) }}" class="ajax">
                    <span>{{ collection.get_name() }}</span>
                </a>
            </div>
            <ul>

            {% if (app['acl'].get(app['authentication'].getUser()).has_right_on_base(collection.get_base_id(), 'modify_struct')) %}
              <li>
                <a target="right" href="{{ path('admin_collection_display_suggested_values', { 'bas_id' : collection.get_base_id() }) }}" class="ajax">
                  <img src="/skins/icons/foldph20open_0.gif"/>
                  <span>{{ 'admin::base: preferences de collection' | trans }}</span>
                </a>
              </li>
            {% endif %}

            {% if (app['acl'].get(app['authentication'].getUser()).has_right_on_base( collection.get_base_id(), 'canadmin')) %}
              {% if (app['acl'].get(app['authentication'].getUser()).has_right_on_base( collection.get_base_id(), 'canmodifrecord')
                 and app['acl'].get(app['authentication'].getUser()).has_right_on_base( collection.get_base_id(), 'manage')
                 and app['acl'].get(app['authentication'].getUser()).has_right_on_sbas( sbas_id, 'bas_manage') ) %}
              <li>
                <a target="right" href="{{ path('admin_users_search', { 'base_id' : [ collection.get_base_id() ] }) }}" class="ajax">
                  <img src="/skins/admin/Users.png"/>
                  <span>{{ 'admin::utilisateurs: utilisateurs' | trans }}</span>
                </a>
              </li>
              {% endif %}
            {% endif %}

            </ul>
          </li>

          {% endif %}
        {% endfor %}

        </ul>
      </li>
    {% endfor %}

    </ul>
  </li>

  {% for databox in off_databoxes %}
  <li>
    <img src="/skins/icons/db-remove.png"/>
    {{ databox.get_dbname() }} ({{ databox.get_host() }} {{ databox.get_port() }})
  </li>
  {% endfor %}
</ul>
