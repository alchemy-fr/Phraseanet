{% import 'prod/actions/Feedback/ListsMacros.html.twig' as ListsMacros %}
<div class="PNB10" style="height: 46px;bottom:auto;line-height:26px;">
    <div class="pull-left">
        <div id="find-user">
            <input class="search" name="users-search" placeholder="Users" type="text" style="width:210px;"/>
        </div>
    </div>
     <div class="pull-left">
        {% if app.getAclForUser(app.getAuthenticatedUser()).has_right(constant('\\ACL::CANADMIN')) %}
            <a href="#" class="push-add-user btn btn-push-orange" style="width:120px;margin-left:30px;margin-top:2px;">
                <img src="/assets/common/images/icons/orange-plus.png" class="image-normal">
                <img src="/assets/common/images/icons/white-plus.png" class="image-hover">
                {{ 'Create a user' | trans }}
            </a>
        {% endif %}
    </div>
     <div class="pull-right">
        <a href="#" class="btn btn-push-orange" style="margin-top:2px;height:20px;line-height:22px;">
            <span>
                <img src="/assets/common/images/icons/orange-share.png" class="image-normal" style="margin-right: 15px;">
                <img src="/assets/common/images/icons/white-share.png" class="image-hover" style="margin-right: 15px;">
            </span>
            {{ 'Share my list' | trans }}
        </a>
    </div>
</div>
<div class="PNB10" style="top:55px;">
    <div class="PNB content user_content readonly grey-bg">
        <div class="PNB10">
            <div class="PNB" style="height:25px; bottom:auto;">
                <p>
                    {% set length = list.getEntries().count() %}
                    <span class="counter current">{% trans with {'%length%' : length} %}%length% peoples{% endtrans %}</span>
                    {% if list.getOwner(app.getAuthenticatedUser()).getRole() >= constant('Alchemy\\Phrasea\\Model\\Entities\\UsrListOwner::ROLE_EDITOR') %}
                        <button class="EditToggle btn btn-inverse">{{ 'Edit' | trans }}</button>
                    {% endif %}
                </p>
            </div>
            <div class="PNB" style="top:35px;overflow:auto;">
                {% set role = list.getOwner(app.getAuthenticatedUser()).getRole() %}
                {% for entry in list.getEntries() %}
                    {{ ListsMacros.badgeReadonly(entry, role) }}
                {% endfor %}
            </div>
        </div>
    </div>
    {% if list.getOwner(app.getAuthenticatedUser()).getRole() >= constant('Alchemy\\Phrasea\\Model\\Entities\\UsrListOwner::ROLE_EDITOR') %}
        <div class="PNB content readwrite user_content" style="display:none;">
            <div class="PNB10" style="height:40px; bottom:auto;">
                <table style="height: 40px;">
                    <tr>
                        <td style="white-space:nowrap;">
                            {% if list.getOwner(app.getAuthenticatedUser()).getRole() >= constant('Alchemy\\Phrasea\\Model\\Entities\\UsrListOwner::ROLE_EDITOR') %}
                                <form class="form-inline" method="POST" name="SaveName" action="{{ path('prod_lists_list_update', { 'list_id' : list.getId() }) }}">
                                    <label style="margin-right: 45px;">{{ 'List Name' | trans }}</label>
                                    <input type="text" name="name" class="text_input_white orange_text" style="margin: 0 5px;" value="{{ list.getName() }}"/>
                                    <button class="saveList pull-right orange_text">
                                        <img src="/assets/common/images/icons/orange-save.png" class="image-normal">
                                        <img src="/assets/common/images/icons/white-save.png" class="image-hover">
                                        {{ 'Save' | trans }}
                                    </button>
                                </form>
                            {% else %}
                                <h1>{{ list.getName() }}</h1>
                            {% endif %}
                        </td>
                        <td style="text-align:right;white-space:nowrap;">
                            {% if list.getOwner(app.getAuthenticatedUser()).getRole() == constant('Alchemy\\Phrasea\\Model\\Entities\\UsrListOwner::ROLE_ADMIN') %}
                                <a href="{{ path('prod_lists_list_share', { 'list_id' : list.getId() }) }}" title="{{ 'Share the list' | trans }}"
                                class="list_sharer push-list-share-action"

                                data-list-id="{{ list.getId() }}">
                                    <img src="/assets/prod/images/Push/list-icon.png" />
                                    {{ "Set sharing permission" | trans }}
                                </a>
                            {% endif %}
                        </td>
                        {% if list.getOwner(app.getAuthenticatedUser()).getRole() >= constant('Alchemy\\Phrasea\\Model\\Entities\\UsrListOwner::ROLE_ADMIN') %}
                            <td style="text-align:right;white-space:nowrap;width:150px;">
                                <button class="deleter btn btn-inverse listmanager-delete-list-action" data-list-id="{{ list.getId() }}">
                                    {{ 'Delete' | trans }}
                                </button>
                            </td>
                        {% endif %}
                    </tr>
                </table>
            </div>
            <form name="list-editor-search" method="POST" action="{{ path('prod_push_list_edit', { 'list_id' : list.getId() }) }}">
                <div class="PNB10 list_editor_search" style="height:160px;">
                    <div class="PNB" style="height:40px;bottom:auto;">
                        <button class="Refresher btn btn-inverse" type="button">&lt;{{ 'View' | trans }}</button>
                        <select name="like_field">
                            <option value="usr_login">
                                {{ 'Push::filter on login' | trans }}
                            </option>
                            <option value="name">
                                {{ 'Push::filter on name' | trans }}
                            </option>
                            <option value="pays">
                                {{ 'Push::filter on countries' | trans }}
                            </option>
                            <option value="societe">
                                {{ 'Push::filter on companies' | trans }}
                            </option>
                            <option value="usr_mail">
                                {{ 'Push::filter on emails' | trans }}
                            </option>
                            <option value="lastModel">
                                {{ 'Push::filter on templates' | trans }}
                            </option>
                        </select>
                        {{ 'Push::filter starts' | trans }}
                        <input type="text" value="" class="search" name="query">
                        <button type="submit" class="btn btn-inverse">{{ 'boutton::chercher' | trans }}</button>
                    </div>
                    <div class="PNB" style="top:40px;height:120px;bottom:auto;">
                        <table style="table-layout:fixed;width:100%;">
                            <tr>
                                <td>
                                    <label>{{ 'Activite' | trans }}</label>
                                </td>
                                <td>
                                    <label>{{ 'Template' | trans }}</label>
                                </td>
                                <td >
                                    <label>{{ 'Company' | trans }}</label>
                                </td>
                                <td >
                                    <label>{{ 'Country' | trans }}</label>
                                </td>
                                <td >
                                    <label>{{ 'Position' | trans }}</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <select size="5" multiple="multiple" name="Activity[]" style="width:80%;">
                                        <option value="">{{ 'All' | trans }}</option>
                                        {% for Activity in query.getRelatedActivities() %}
                                            <option value="{{ Activity }}">{{ Activity }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td>
                                    <select size="5" multiple="multiple" name="Template[]" style="width:80%;">
                                        <option value="">{{ 'All' | trans }}</option>
                                        {% for Template in query.getRelatedTemplates() %}
                                            <option value="{{ Template }}">{{ Template }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td>
                                    <select size="5" multiple="multiple" name="Company[]" style="width:80%;">
                                        <option value="">{{ 'All' | trans }}</option>
                                        {% for Company in query.getRelatedCompanies() %}
                                            <option value="{{ Company }}">{{ Company }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td>
                                    <select size="5" multiple="multiple" name="Country[]" style="width:80%;">
                                        <option value="">{{ 'All' | trans }}</option>
                                        {% for Code, Country in query.getRelatedCountries() %}
                                            <option value="{{ Code }}">{{ Country }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td>
                                    <select size="5" multiple="multiple" name="Position[]" style="width:80%;">
                                        <option value="">{{ 'All' | trans }}</option>
                                        {% for Position in query.getRelatedPositions() %}
                                            <option value="{{ Position }}">{{ Position }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <input type="hidden" name="page" value="" />
                <input type="hidden" name="srt" value="{{ sort }}" />
                <input type="hidden" name="ord" value="{{ ord }}" />
                <input type="hidden" name="type" value="fragment" />
            </form>
            <div class="PNB content" style="top:230px;">
                <div class="PNB10">
                    {{ ListsMacros.ResultTable(query, results, list, sort, ord) }}
                </div>
            </div>
        </div>
    {% endif %}
</div>
