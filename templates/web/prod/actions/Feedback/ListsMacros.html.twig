{% macro ResultTable(query, results, list, sort, ord) %}
<div id="list-editor-search-results" class="list-editor-results PNB">
  <div class="PNB" style="overflow-y:scroll;overflow-x:hidden;bottom:20px;">
    <table style="width:100%;table-layout:fixed;">
        <thead>
          <tr>
            <th style="text-align: center;" class="sortable {{ sort == 'usr_login' ? 'sorted' :  '' }} {{ ord == 'asc' ? 'sort_asc' :  'sort_desc' }}">
              {{ 'Login' | trans }}
              <span class="ord_notifier">
                {{ ord == 'asc' ? '&#x25bc;' :  '&#x25B2;' }}
              </span>
              <input type="hidden" name="srt" value="usr_login" />
            </th>
            <th style="text-align: center;" class="sortable {{ sort == 'usr_nom' ? 'sorted' :  '' }} {{ ord == 'asc' ? 'sort_asc' :  'sort_desc' }}">
              {{ 'First/Last Name' | trans }}
              <span class="ord_notifier">
                {{ ord == 'asc' ? '&#x25bc;' :  '&#x25B2;' }}
              </span>
              <input type="hidden" name="srt" value="usr_nom" />
            </th>
            <th style="text-align: center;" class="sortable {{ sort == 'societe' ? 'sorted' :  '' }} {{ ord == 'asc' ? 'sort_asc' :  'sort_desc' }}">
              {{ 'Company' | trans }}
              <span class="ord_notifier">
                {{ ord == 'asc' ? '&#x25bc;' :  '&#x25B2;' }}
              </span>
              <input type="hidden" name="srt" value="societe" />
            </th>
            <th style="text-align: center;" class="sortable {{ sort == 'usr_mail' ? 'sorted' :  '' }} {{ ord == 'asc' ? 'sort_asc' :  'sort_desc' }}">
              {{ 'E-Mail' | trans }}
              <span class="ord_notifier">
                {{ ord == 'asc' ? '&#x25bc;' :  '&#x25B2;' }}
              </span>
              <input type="hidden" name="srt" value="usr_mail" />
            </th>
            <th style="text-align: center;" class="sortable {{ sort == 'pays' ? 'sorted' :  '' }} {{ ord == 'asc' ? 'sort_asc' :  'sort_desc' }}">
              {{ 'Country' | trans }}
              <span class="ord_notifier">
                {{ ord == 'asc' ? '&#x25bc;' :  '&#x25B2;' }}
              </span>
              <input type="hidden" name="srt" value="pays" />
            </th>
            <th style="text-align: center;" class="sortable {{ sort == 'lastModel' ? 'sorted' :  '' }} {{ ord == 'asc' ? 'sort_asc' :  'sort_desc' }}">
              {{ 'Last Template' | trans }}
              <span class="ord_notifier">
                {{ ord == 'asc' ? '&#x25bc;' :  '&#x25B2;' }}
              </span>
              <input type="hidden" name="srt" value="lastModel" />
            </th>
            <th style="text-align: center;" class="sortable {{ sort == 'usr_creationdate' ? 'sorted' :  '' }} {{ ord == 'asc' ? 'sort_asc' :  'sort_desc' }}">
              {{ 'Creation date' | trans }}
              <span class="ord_notifier">
                {{ ord == 'asc' ? '&#x25bc;' :  '&#x25B2;' }}
              </span>
              <input type="hidden" name="srt" value="usr_creationdate" />
            </th>
          </tr>
        </thead>
        <tbody>
          {% for user in results %}
          <tr class="{% if list.has(user) %} selected {% endif %}{% if loop.index is odd %} odd {% endif %}">
            <td>
              {{ user.getLogin() }}
              <input name="usr_id" value="{{ user.getId() }}" type="hidden" />
            </td>
            <td>
              {{ user.getFirstName() }} / {{ user.getLastName() }}
            </td>
            <td>
              {{ user.getCompany() }}
            </td>
            <td>
              {{ user.getEmail() }}
            </td>
            <td>
              {{ user.getCountry() }}
            </td>
            <td>
                {% if user.getLastAppliedTemplate() is null %} - {% else %} {{ user.getLastAppliedTemplate().getLogin() }} {% endif %}
            </td>
            <td>
              {{ app['date-formatter'].getDate(user.getCreated()) }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
    </table>
  </div>
  <div class="PNB" style="top:auto;height:20px;text-align:right;line-height:20px;">
    {% set length = list.getEntries().count() %}
    <span class="counter current">{% trans with {'%length%' : length} %}%length% peoples{% endtrans %}</span>
    {% if query.get_page() > 1 %}
      <a class="prev" value="{{ query.get_page() - 1 }}" href="#">< {{ 'Previous' | trans }}</a>
    {% endif %}
    {{ query.get_page() }} / {{ query.get_total_page() }}
    {% if query.get_page() < query.get_total_page() %}
      <a class="next" value="{{ query.get_page() + 1 }}" href="#">{{ 'Next' | trans }} ></a>
    {% endif %}
  </div>
</div>
{% endmacro %}

{# ResultTableJavascript use to call just once a time in a page after ResultTable #}
{% macro  ResultTableJavascript()%}
  <script type="text/javascript">

  $(document).ready(function(){
    var $editor = $('#list-editor-search-results');

          $editor.on('click', 'a.next, a.prev', function(){
              var page = $(this).attr('value');

      $('input[name="page"]', $form).val(page);
      $form.trigger('submit');

      return false;
    });

    var $form = $('#ListManager .editor').find('form[name="list-editor-search"]');

    $('input[name="page"]', $form).val('');

          $editor.on('click', 'th.sortable', function (){
//          $('th.sortable', $editor).bind('click', function(){

      var $this = $(this);

      var sort = $('input', $this).val();

      if((sort == $('input[name="srt"]', $form).val())
        && ($('input[name="ord"]', $form).val() == 'asc'))
      {
        var ord = 'desc';
      }
      else
      {
        var ord = 'asc';
      }

      $('input[name="srt"]', $form).val(sort);
      $('input[name="ord"]', $form).val(ord);

              $form.trigger('submit');
          })
              .on('mouseover', 'th.sortable', function(){$(this).addClass('hover');})
              //              .bind('mouseover', function(){$(this).addClass('hover');})
              .on('mouseout', 'th.sortable', function(){$(this).removeClass('hover');});
//              .bind('mouseout', function(){$(this).removeClass('hover');});

          $editor.on('click', 'tbody tr', function(){
//          $('tbody tr', $editor).bind('click', function(){

      var $this = $(this);
      var usr_id = $('input[name="usr_id"]', $this).val();

      var counters = $('#ListManager .counter.current, #ListManager .lists .list.selected .counter');

      if($this.hasClass('selected'))
      {
        $this.removeClass('selected');
        p4.ListManager.getList().removeUser(usr_id);

        counters.each(function(i,el){
          var n = parseInt($(el).text());
          $(el).text(n - 1);
        });
      }
      else
      {
        $this.addClass('selected');
        p4.ListManager.getList().addUser(usr_id);

        counters.each(function(i,el){
          var n = parseInt($(el).text());
          $(el).text(n + 1);
        });
      }

    });
  });
  </script>

{% endmacro %}


{% macro badgeReadonly(entry, role) %}
  <div class="badge">
    <input type="hidden" value="{{ entry.getUser().getId() }}" name="id">
    {% if role >= constant('Alchemy\\Phrasea\\Model\\Entities\\UsrListOwner::ROLE_EDITOR') %}
      <a class="deleter" href="#">
        <img src="/assets/prod/images/Push/close_badge.png">
      </a>
    {% endif %}
    <table>
      <tr>
        <td>
          <img src="/assets/common/images/icons/user.png"/>
        </td>
        <td class="infos" >
          <span class="name">{{ entry.getUser().getDisplayName() }}</span>
          <span class="subtite"></span>
        </td>
      </tr>
    </table>
  </div>
{% endmacro %}
