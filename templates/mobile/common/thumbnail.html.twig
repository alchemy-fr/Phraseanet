{% macro format(thumbnail, b_w, b_h, extraclass)%}
    {% set b_width = b_w %}
    {% set b_height = b_h|default(b_w) %}

    {% set b_ratio = b_width / b_height %}

    {% set thumbnail_height = thumbnail.get_height() > 0 ? thumbnail.get_height() : 120 %}
    {% set thumbnail_width = thumbnail.get_width() > 0 ? thumbnail.get_width() : 120 %}

    {% set i_ratio = thumbnail_width / thumbnail_height %}

    {% if i_ratio > b_ratio%}
        {% if b_width > thumbnail_width %}
            {% set d_width = thumbnail_width %}
        {% else %}
            {% set d_width = b_width %}
        {% endif %}
        {% set d_height = d_width / thumbnail_width * thumbnail_height %}
        {% set top = (b_height - d_height) / 2 %}
    {% else %}
        {% if b_height > thumbnail_height %}
            {% set d_height = thumbnail_height %}
        {% else %}
            {% set d_height = b_height %}
        {% endif %}
        {% set d_width = d_height * thumbnail_width / thumbnail_height %}
        {% set top = ((b_height - d_height) / 2) %}
    {% endif %}


        {% set record_type = thumbnail.get_type() %}
        <div style="width:{{b_width|round}}px;height:{{b_height|round}}px;" class="thumb_wrapper {{extraclass|default('')}}">
        {% if record_type == 'VIDEO_MP4' or record_type == 'VIDEO_FLV' %}
          {% set random = thumbnail.get_random() %}
          <div class="record record_video imgTips" style="width:{{d_width|round}}px;height:{{d_height|round}}px;top:{{top|round}}px;">
            <video type="video/mp4" controls="controls" style="width:{{d_width|round}}px;height:{{d_height|round}}px;" autoplay="autoplay">
              <source src="{{thumbnail.get_url()}}" type="video/mp4" />
            </video>
          </div>
        {% elseif record_type == 'FLEXPAPER' %}
          {% set random = thumbnail.get_random() %}
          <div class="record record_document imgTips" style="width:{{d_width|round}}px;height:{{d_height|round}}px;top:{{top|round}}px;">
              <div id="preview_{{thumbnail.get_base_id()}}_{{thumbnail.get_record_id()}}_{{random}}" class="PNB" style=""></div>
            <input type="hidden" name="width" value="{{thumbnail_width}}"/>
            <input type="hidden" name="height" value="{{thumbnail_height}}"/>
          </div>
          <script type="text/javascript">
            swfobject.embedSWF("/include/FlexPaper_flash/FlexPaperViewer.swf",
            "preview_{{thumbnail.get_base_id()}}_{{thumbnail.get_record_id()}}_{{random}}",
            "100%", "100%", "9.0.0", false, false,
            {menu: "false",flashvars: "SwfFile={{thumbnail.get_url()}}&Scale=0.6&ZoomTransition=easeOut&ZoomTime=0.5&ZoomInterval=0.1&FitPageOnLoad=true&FitWidthOnLoad=true&PrintEnabled=true&FullScreenAsMaxWindow=false&localeChain={{ app['locale'] }}",  movie: "/include/FlexPaper_flash/FlexPaperViewer.swf",  allowFullScreen :"true",wmode: "transparent"}, false);</script>

        {% elseif record_type == 'AUDIO_MP3' %}
          {% set random = thumbnail.get_random() %}
          <div class="record record_audio audioTips" style="width:{{d_width|round}}px;height:{{d_height|round}}px;top:{{top|round}}px;">
            <div id="preview_{{thumbnail.get_base_id()}}_{{thumbnail.get_record_id()}}_{{random}}" class="PNB" style=""></div>
            <input type="hidden" name="width" value="{{thumbnail_width}}"/>
            <input type="hidden" name="height" value="{{thumbnail_height}}"/>
          </div>
          <script type="text/javascript">
            swfobject.embedSWF("/include/jslibs/audio-player/player.swf",
            "preview_{{thumbnail.get_base_id()}}_{{thumbnail.get_record_id()}}_{{random}}",
            "{{thumbnail_width}}", "{{thumbnail_height}}", "9.0.0", false, false,
            {menu: "false",flashvars: "playerID=2&autostart=yes&noinfo=yes&animation=no&remaining=yes&soundFile={{thumbnail.get_url()}}", movie: "/include/jslibs/audio-player/player.swf",  allowFullScreen :"true",wmode: "transparent"}, false);</script>
        {% else %}
          <img class="record record_image imgTips zoomable thumb" oncontextMenu="return(false);"
               style="width:{{d_width|round}}px;height:{{d_height|round}}px;top:{{top|round}}px;"
               src="{{thumbnail.get_url()}}" ondragstart="return false;">
          <input type="hidden" name="width" value="{{thumbnail_width}}"/>
          <input type="hidden" name="height" value="{{thumbnail_height}}"/>
        {% endif %}
        </div>


{% endmacro %}

{% macro format100percent(thumbnail, extraclass)%}
    {% set record_type = thumbnail.get_type() %}
        {% if record_type == 'VIDEO_MP4' or record_type == 'VIDEO_FLV' %}
          {% set random = thumbnail.get_random() %}
          <div class="record record_video imgTips">
            <video type="video/mp4" controls="controls" style="height:80%;width:80%;max-height: 80%;max-width:80%; margin: 0 auto" autoplay="autoplay">
              <source src="{{thumbnail.get_url()}}" type="video/mp4" />
            </video>
          </div>
        {% elseif record_type == 'FLEXPAPER' %}
          {% set random = thumbnail.get_random() %}
          <div class="record record_document imgTips" style="width:100%;">
              <div id="preview_{{thumbnail.get_base_id()}}_{{thumbnail.get_record_id()}}_{{random}}" class="PNB" style=""></div>
          </div>
          <script type="text/javascript">
            swfobject.embedSWF("/include/FlexPaper_flash/FlexPaperViewer.swf",
            "preview_{{thumbnail.get_base_id()}}_{{thumbnail.get_record_id()}}_{{random}}",
            "100%", "100%", "9.0.0", false, false,
            {menu: "false",flashvars: "SwfFile={{thumbnail.get_url()}}&Scale=0.6&ZoomTransition=easeOut&ZoomTime=0.5&ZoomInterval=0.1&FitPageOnLoad=true&FitWidthOnLoad=true&PrintEnabled=true&FullScreenAsMaxWindow=false&localeChain={{app['locale']}}",  movie: "/include/FlexPaper_flash/FlexPaperViewer.swf",  allowFullScreen :"true",wmode: "transparent"}, false);</script>

        {% elseif record_type == 'AUDIO_MP3' %}
          {% set random = thumbnail.get_random() %}
          <div class="record record_audio audioTips" style="width:100%;">
            <div id="preview_{{thumbnail.get_base_id()}}_{{thumbnail.get_record_id()}}_{{random}}" class="PNB" style=""></div>
          </div>
          <script type="text/javascript">
            swfobject.embedSWF("/include/jslibs/audio-player/player.swf",
            "preview_{{thumbnail.get_base_id()}}_{{thumbnail.get_record_id()}}_{{random}}",
            "{{thumbnail.get_width()}}", "{{thumbnail.get_height()}}", "9.0.0", false, false,
            {menu: "false",flashvars: "playerID=2&autostart=yes&noinfo=yes&animation=no&remaining=yes&soundFile={{thumbnail.get_url()}}", movie: "/include/jslibs/audio-player/player.swf",  allowFullScreen :"true",wmode: "transparent"}, false);</script>
        {% else %}
          <img style="max-height: 100%;max-width:100%" class="record record_image imgTips zoomable thumb" oncontextMenu="return(false);"
               src="{{thumbnail.get_url()}}" ondragstart="return false;" />
        {% endif %}
{% endmacro %}
